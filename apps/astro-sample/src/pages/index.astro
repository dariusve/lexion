---
import "../styles/global.css";
---

<main class="shell">
  <h1>Astro Adapter Sample</h1>
  <div class="toolbar">
    <button id="bold" type="button">Toggle Bold</button>
    <button id="readonly" type="button">Toggle Read Only</button>
  </div>
  <section class="editor" id="editor"></section>
  <pre class="state" id="state"></pre>
</main>

<script>
  import { starterKitCommandNames } from "@lexion-rte/extensions";
  import { mountLexionAstroEditor } from "@lexion-rte/astro";

  const createDoc = (text) => ({
    type: "doc",
    content: [
      {
        type: "paragraph",
        content: [{ type: "text", text }]
      }
    ]
  });

  const editorElement = document.querySelector("#editor");
  const stateElement = document.querySelector("#state");
  const boldButton = document.querySelector("#bold");
  const readOnlyButton = document.querySelector("#readonly");

  if (!(editorElement instanceof HTMLElement)) throw new Error("Missing editor element");
  if (!(stateElement instanceof HTMLElement)) throw new Error("Missing state element");
  if (!(boldButton instanceof HTMLButtonElement)) throw new Error("Missing bold button");
  if (!(readOnlyButton instanceof HTMLButtonElement)) throw new Error("Missing readonly button");

  let readOnly = false;

  const adapter = mountLexionAstroEditor({
    element: editorElement,
    defaultValue: createDoc("Hello from @lexion-rte/astro"),
    onChange: (value) => {
      stateElement.textContent = JSON.stringify(value, null, 2);
    }
  });

  const currentEditor = adapter.editor;
  if (currentEditor) {
    stateElement.textContent = JSON.stringify(currentEditor.getJSON(), null, 2);
  }

  boldButton.addEventListener("click", () => {
    adapter.execute(starterKitCommandNames.toggleBold);
  });

  readOnlyButton.addEventListener("click", () => {
    readOnly = !readOnly;
    adapter.update({ readOnly });
    readOnlyButton.textContent = readOnly ? "Set Editable" : "Toggle Read Only";
  });

  window.addEventListener(
    "beforeunload",
    () => {
      adapter.destroy();
    },
    { once: true }
  );
</script>
